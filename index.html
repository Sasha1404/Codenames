<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generador de Cartas Codenames · 1 archivo</title>
  <style>
    :root {
      --bg: #f7f7f8;
      --card: #ffffff;
      --ink: #111827;
      --muted: #6b7280;
      --red: #dc2626; --red-b:#991b1b; --blue:#2563eb; --blue-b:#1e40af;
      --green:#16a34a; --green-b:#166534; --amber:#fde68a; --amber-b:#f59e0b; --black:#0b0b0c;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial; color:var(--ink); background: linear-gradient(#fafafa, #f1f5f9); }
    .container { max-width: 980px; margin: 24px auto; padding: 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: 12px; }
    h1 { font-size: 20px; margin:0; }
    .card { background: var(--card); border:1px solid #e5e7eb; border-radius: var(--radius); box-shadow: 0 1px 2px rgba(0,0,0,.05); }
    .card .body{ padding:16px; }

    .controls { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; }
    .controls label { font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
    select, input[type="text"], button { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; font-size:14px; }
    button { cursor:pointer; }
    button.primary { background:#111827; color:#fff; border-color:#111827; }
    button.ghost { background:#fff; color:#111827; }

    .grid-wrap { position:relative; }
    .watermark { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:72px; letter-spacing:10px; opacity:.06; user-select:none; pointer-events:none; text-align:center; }

    .board { --cols:5; --rows:5; width:min(92vw, 640px); aspect-ratio: var(--cols) / var(--rows); margin: 0 auto; padding:10px; background:#fff; border:1px solid #e5e7eb; border-radius:18px; display:grid; grid-template-columns: repeat(var(--cols), 1fr); grid-template-rows: repeat(var(--rows), 1fr); grid-gap:8px; }
    .cell { position:relative; border-radius:12px; color:#fff; font-weight:700; display:flex; align-items:center; justify-content:center; text-shadow: 0 1px 1px rgba(0,0,0,.35); }
    .cell .idx { position:absolute; top:6px; right:8px; font-size:10px; opacity:.8; }

    /* colors */
    .red { background: var(--red); border:1px solid var(--red-b); }
    .blue { background: var(--blue); border:1px solid var(--blue-b); }
    .neutral { background: var(--amber); border:1px solid var(--amber-b); color:#1f2937; text-shadow:none; }
    .assassin, .black { background: var(--black); border:1px solid #111; }
    .green { background: var(--green); border:1px solid var(--green-b); }

    /* colorblind patterns (simple, CSS-only) */
    .cb .red { background-image: repeating-linear-gradient(45deg, rgba(255,255,255,.25) 0 6px, rgba(255,255,255,0) 6px 12px); }
    .cb .blue { background-image: radial-gradient(rgba(255,255,255,.3) 1px, transparent 1px); background-size: 8px 8px; }
    .cb .neutral { background-image: linear-gradient(rgba(255,255,255,.35), rgba(255,255,255,.35)); }
    .cb .assassin, .cb .black { background-image: linear-gradient(0deg, rgba(255,255,255,.15) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,.15) 1px, transparent 1px); background-size: 8px 8px; }
    .cb .green { background-image: repeating-linear-gradient(0deg, rgba(255,255,255,.25) 0 4px, rgba(255,255,255,0) 4px 8px); }

    .legend { font-size:14px; color:#374151; }
    .legend ul { list-style:none; padding:0; margin:0; display:grid; gap:8px; }
    .legend li { display:flex; align-items:center; gap:8px; }
    .dot { width:14px; height:14px; border-radius:4px; display:inline-block; border:1px solid rgba(0,0,0,.1); }

    .aside { display:grid; grid-template-columns: 1fr; gap:12px; }

    .two { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 980px){ .two { grid-template-columns: 1fr 320px; } }

    .muted { color: var(--muted); font-size:12px; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; color:#fff; font-weight:700; font-size:12px; }
    .badge.red { background: var(--red); }
    .badge.blue { background: var(--blue); }

    .qr { display:flex; flex-direction:column; align-items:center; gap:8px; }
    .qr img { width:220px; height:220px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }

    .quote { font-size:14px; color:#111827; line-height:1.5; }
    .quote small { color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Generador de Cartas Codenames (1 archivo)</h1>
      <div class="muted">Tema: <span id="themeLabel">Otaku</span></div>
    </header>

    <div class="card">
      <div class="body">
        <div class="controls">
          <div>
            <label>Variante</label>
            <select id="variant">
              <option value="original">Codenames (original)</option>
              <option value="pictures">Codenames: Pictures (5×4)</option>
              <option value="duet">Codenames: Duet</option>
            </select>
          </div>
          <div>
            <label>Tema visual</label>
            <select id="theme">
              <option value="otaku">Otaku (animes)</option>
              <option value="andaluz">Andaluza</option>
            </select>
          </div>
          <div>
            <label>Semilla</label>
            <input id="seedInput" type="text" placeholder="número o texto" />
          </div>
          <div style="display:flex; gap:8px; align-items:flex-end;">
            <button id="useSeed" class="ghost">Usar</button>
            <button id="randSeed" class="ghost">Aleatoria</button>
            <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted); margin-left:auto;">
              <input type="checkbox" id="cbToggle"/> Daltónicos
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="two" style="margin-top:12px;">
      <div class="card">
        <div class="body">
          <div class="grid-wrap">
            <div class="watermark" id="wm">OTAKU</div>
            <div id="board" class="board"></div>
          </div>
          <div style="display:flex; align-items:center; gap:8px; margin-top:10px; flex-wrap:wrap;">
            <span id="startBadge" class="badge" style="display:none"></span>
            <span class="muted">Semilla: <span id="seedLabel"></span></span>
          </div>
          <div class="quote" id="quoteBox" style="margin-top:12px;"></div>
        </div>
      </div>

      <div class="aside">
        <div class="card">
          <div class="body legend">
            <h3 style="margin:0 0 8px 0; font-size:16px;">Leyenda</h3>
            <ul id="legendList"></ul>
            <p class="muted" style="margin-top:8px;">Las cartas objetivo son las "claves" que ven los líderes. Usa la misma semilla para recrear exactamente la misma carta.</p>
          </div>
        </div>

        <div class="card">
          <div class="body">
            <h3 style="margin:0 0 8px 0; font-size:16px;">Compartir por QR</h3>
            <div class="qr">
              <img id="qrImg" alt="QR" src=""/>
              <div class="muted" style="word-break:break-all; font-size:11px;" id="shareUrl"></div>
              <div style="display:flex; gap:8px; width:100%;">
                <button id="openUrl" class="ghost">Abrir</button>
                <button id="copyUrl" class="ghost">Copiar URL</button>
                <button id="downloadQR" class="primary">Descargar QR</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:12px;">Consejo: sube este <strong>index.html</strong> a Netlify Drop (arrastrar y soltar) o a GitHub Pages y comparte el QR.</p>
  </div>

<script>
// ===== Utilidades de semilla y aleatoriedad =====
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296;}};
function seededShuffle(arr, seed){const rng = mulberry32(seed); const a = arr.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(rng()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a;}
function hashSeed(str){let h=2166136261>>>0; for(let i=0;i<str.length;i++){h^=str.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0;}
function parseSeed(input){ if(!input) return (Date.now()>>>0); const n = Number(input); return Number.isFinite(n) && n>0 ? (n>>>0) : hashSeed(String(input)); }

// ===== Frases (Otaku & Andaluza) =====
const QUOTES = {
  otaku: [
    { text: '¡Seré el Rey de los Piratas!', author: 'Monkey D. Luffy · One Piece' },
    { text: 'Yo soy el más fuerte.', author: 'Satoru Gojo · Jujutsu Kaisen' },
    { text: '¡Plus Ultra!', author: 'All Might · My Hero Academia' },
    { text: '¡Entreguen sus corazones!', author: 'Erwin Smith · Attack on Titan' },
    { text: 'Levántate.', author: 'Sung Jin-Woo · Solo Leveling' },
    { text: 'Solo soy un tipo que es héroe por diversión.', author: 'Saitama · One Punch Man' },
    { text: '¡Kamehame-ha!', author: 'Son Goku · Dragon Ball' },
    { text: '¡Nunca me rendiré!', author: 'Tanjiro Kamado · Demon Slayer' },
    { text: '¡Saltamos más alto!', author: 'Shōyō Hinata · Haikyu!!' }
  ],
  andaluz: [
    { text: 'La inspiración existe, pero tiene que encontrarte trabajando.', author: 'Pablo Picasso' },
    { text: 'Caminante, no hay camino; se hace camino al andar.', author: 'Antonio Machado' },
    { text: 'El más terrible de los sentimientos es el de tener la esperanza perdida.', author: 'Federico García Lorca' },
    { text: 'Andalucía, por sí, para España y la Humanidad.', author: 'Blas Infante' },
    { text: 'Quien no ha visto Sevilla, no ha visto maravilla.', author: 'Refrán andaluz' }
  ]
};

function pickQuote(theme, seed){
  const list = QUOTES[theme] || [];
  if(!list.length) return null;
  const idx = Math.floor(mulberry32(seed)()*list.length);
  return list[idx];
}

// ===== Generación de carta =====
function generateKey(variant, seed){
  if(variant === 'duet'){
    // 5x5, pero distribución cooperativa (9/13/3)
    const cells = [ ...Array(9).fill('green'), ...Array(13).fill('neutral'), ...Array(3).fill('black') ];
    return { grid: seededShuffle(cells, seed), rows:5, cols:5, startTeam: undefined };
  } else if (variant === 'pictures') {
    // 5x4, 20 casillas: empieza con 8, el otro 7, 4 neutrales, 1 asesino
    const rng = mulberry32(seed);
    const startRed = rng() < 0.5;
    const redCount = startRed ? 8 : 7;
    const blueCount = startRed ? 7 : 8;
    const cells = [ ...Array(redCount).fill('red'), ...Array(blueCount).fill('blue'), ...Array(4).fill('neutral'), 'assassin' ];
    return { grid: seededShuffle(cells, Math.floor(rng()*2**31)), rows:4, cols:5, startTeam: startRed?'red':'blue' };
  } else {
    // original 5x5: 9 / 8 / 7 / 1
    const rng = mulberry32(seed);
    const startRed = rng() < 0.5;
    const redCount = startRed ? 9 : 8;
    const blueCount = startRed ? 8 : 9;
    const cells = [ ...Array(redCount).fill('red'), ...Array(blueCount).fill('blue'), ...Array(7).fill('neutral'), 'assassin' ];
    return { grid: seededShuffle(cells, Math.floor(rng()*2**31)), rows:5, cols:5, startTeam: startRed?'red':'blue' };
  }
}

// ===== Dibujo y estado =====
const el = (id)=>document.getElementById(id);
const $variant = el('variant');
const $theme = el('theme');
const $seedInput = el('seedInput');
const $useSeed = el('useSeed');
const $randSeed = el('randSeed');
const $cbToggle = el('cbToggle');
const $wm = el('wm');
const $board = el('board');
const $legend = el('legendList');
const $seedLabel = el('seedLabel');
const $startBadge = el('startBadge');
const $themeLabel = el('themeLabel');
const $qrImg = el('qrImg');
const $shareUrl = el('shareUrl');
const $openUrl = el('openUrl');
const $copyUrl = el('copyUrl');
const $downloadQR = el('downloadQR');
const $quoteBox = el('quoteBox');

let state = { variant:'original', theme:'otaku', seed: (Date.now()>>>0), cb:false };

function labelFor(kind, variant){
  if(variant==='duet') return kind==='green'?'AGENTE':(kind==='black'?'ASESINO':'VIANDANTE');
  return kind==='red'?'ROJO': kind==='blue'?'AZUL': kind==='assassin'?'ASESINO':'NEUTRO';
}

function tokenColor(kind){
  return kind==='red'?'red': kind==='blue'?'blue': kind==='assassin'||kind==='black'?'black': kind==='green'?'green':'neutral';
}

function draw(){
  document.body.classList.toggle('cb', state.cb);
  $themeLabel.textContent = state.theme==='otaku'?'Otaku':'Andaluza';
  $wm.textContent = state.theme==='otaku'?'OTAKU':'ANDALUZA';
  $seedLabel.textContent = state.seed;

  const data = generateKey(state.variant, state.seed);
  const grid = data.grid, rows = data.rows, cols = data.cols, startTeam = data.startTeam;

  // Ajustar rejilla
  $board.style.setProperty('--rows', String(rows));
  $board.style.setProperty('--cols', String(cols));

  // Render board
  $board.innerHTML = '';
  grid.forEach((kind, i)=>{
    const div = document.createElement('div');
    div.className = 'cell ' + tokenColor(kind);
    div.innerHTML = '<div>'+labelFor(kind, state.variant)+'</div><div class="idx">'+(i+1)+'</div>';
    $board.appendChild(div);
  });

  // Start badge (solo original/pictures)
  if(startTeam){
    $startBadge.style.display='inline-block';
    $startBadge.className = 'badge ' + (startTeam==='red'?'red':'blue');
    const n = (state.variant==='pictures') ? 8 : 9;
    $startBadge.textContent = 'Empieza: ' + (startTeam==='red'?'ROJO ('+n+')':'AZUL ('+n+')');
  } else {
    $startBadge.style.display='none';
  }

  // Leyenda
  const counts = grid.reduce((acc,k)=> (acc[k]=(acc[k]||0)+1, acc), {});
  $legend.innerHTML='';
  if(state.variant==='duet'){
    $legend.appendChild(liLegend('green','Agentes (9)', counts['green']||0));
    $legend.appendChild(liLegend('neutral','Viandantes (13)', counts['neutral']||0));
    $legend.appendChild(liLegend('black','Asesinos (3)', counts['black']||0));
  } else if (state.variant==='pictures') {
    $legend.appendChild(liLegend('red','Equipo rojo', counts['red']||0));
    $legend.appendChild(liLegend('blue','Equipo azul', counts['blue']||0));
    $legend.appendChild(liLegend('neutral','Neutros (4)', counts['neutral']||0));
    $legend.appendChild(liLegend('assassin','Asesino (1)', counts['assassin']||0));
  } else {
    $legend.appendChild(liLegend('red','Equipo rojo', counts['red']||0));
    $legend.appendChild(liLegend('blue','Equipo azul', counts['blue']||0));
    $legend.appendChild(liLegend('neutral','Neutros (7)', counts['neutral']||0));
    $legend.appendChild(liLegend('assassin','Asesino (1)', counts['assassin']||0));
  }

  // Frase temática (determinística con semilla)
  const q = pickQuote(state.theme, state.seed);
  if(q){
    $quoteBox.innerHTML = '“'+q.text+'”<br><small>— '+q.author+'</small>';
  } else {
    $quoteBox.textContent = '';
  }

  updateShare();
}

function liLegend(kind, label, n){
  const li = document.createElement('li');
  const dot = document.createElement('span'); dot.className='dot '+tokenColor(kind);
  li.appendChild(dot);
  const nEl = document.createElement('span'); nEl.textContent = String(n).padStart(2,'0'); nEl.style.fontVariantNumeric='tabular-nums'; nEl.style.minWidth='2ch';
  li.appendChild(nEl);
  const t = document.createElement('span'); t.textContent = ' '+label; t.style.color='#4b5563';
  li.appendChild(t);
  return li;
}

function updateShare(){
  const base = window.location.origin + window.location.pathname;
  const params = new URLSearchParams();
  params.set('variant', state.variant);
  params.set('theme', state.theme);
  params.set('seed', state.seed);
  const url = base + '?' + params.toString();
  $shareUrl.textContent = url;
  history.replaceState(null,'', url);
  // QR usando un servicio público (rápido):
  const encoded = encodeURIComponent(url);
  const qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=256x256&data='+encoded;
  $qrImg.src = qrUrl;
  $downloadQR.onclick = ()=>{
    const a=document.createElement('a'); a.href=qrUrl; a.download='qr-codenames.png'; a.click();
  };
}

// ===== Eventos =====
$variant.onchange = ()=>{ state.variant=$variant.value; draw(); };
$theme.onchange = ()=>{ state.theme=$theme.value; draw(); };
$useSeed.onclick = ()=>{ state.seed = parseSeed($seedInput.value.trim()); draw(); };
$randSeed.onclick = ()=>{ state.seed = (Date.now()>>>0); $seedInput.value=String(state.seed); draw(); };
$cbToggle.onchange = ()=>{ state.cb = $cbToggle.checked; draw(); };
$openUrl.onclick = ()=>{ window.open($shareUrl.textContent, '_blank'); };
$copyUrl.onclick = ()=>{ navigator.clipboard && navigator.clipboard.writeText($shareUrl.textContent); };

// ===== Carga inicial (leer query params) =====
(function init(){
  const q = new URLSearchParams(window.location.search);
  const v = q.get('variant');
  const t = q.get('theme');
  const s = q.get('seed');
  if(v){ state.variant=v; $variant.value=v; }
  if(t){ state.theme=t; $theme.value=t; }
  if(s){ state.seed = Number(s)||parseSeed(s); $seedInput.value = s; }
  else { $seedInput.value = String(state.seed); }
  draw();
})();
</script>
</body>
</html>
